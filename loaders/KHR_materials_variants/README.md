# [Three.js](https://threejs.org) [GLTFLoader](https://threejs.org/docs/#examples/en/loaders/GLTFLoader) [KHR_materials_variants](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_variants) extension

## How to use

```javascript
import * as THREE from 'path_to_three.module.js';
import { GLTFLoader } from 'path_to_GLTFLoader.js';
import GLTFMaterialsVariantsExtension from 'path_to_three-gltf-plugins/loaders/KHR_materials_variants/plugin.js';

const loader = new GLTFLoader();
loader.register(parser => new GLTFMaterialsVariantsExtension(parser));
loader.load(path_to_gltf_asset, async gltf => {
  const variants = gltf.userData.variants; // [variantName0, variantName1, ...]
  const variantName = variants[theIndexYouWantToUse];
  await gltf.functions.selectVariantByName(gltf.scene, variantName);
  render();
});
```

## Compatible Three.js revision

&gt;= r126dev

## API

If glTF file includes `KHR_materials_variants` extension, the result returned by the loader will have the following data and function.

**gltf.userData.variants**

**gltf.scene.userData.variants**

**gltf.scenes[n].userData.variants**

`variants` is an array of variant names like `[variantName0, variantName1, ...]`.

**mesh.userData.gltfExtensions.KHR_materials_variants**

`KHR_materials_variants` is an object which stores `KHR_materials_variants` 

**gltf.functions.selectVariantByName(scene: THREE.Scene, variantName: string): Promise**
**gltf.functions.selectVariantByIndex(scene: THREE.Scene, variantIndex: number): Promise**

`selectVariantByName/Index()` are functions to switch materials to the ones associated with `variantName/Index` for all meshes under a `scene`. The returned Promise will be resolved when all the selected materials are ready.

**gltf.functions.ensureLoadVariants(scene: THREE.Scene): Promise**

`ensureLoadVariants()` is a function to ensure all the variant materials are loaded and saved under `mesh.userData.variantMaterials` for each mesh (See [Side effects](#Side-effects) below). You are recommended to call this function before exporting a scene with [GLTFExporter KHR_materials_variants plugin](../../exporters/KHR_materials_variants/#README.md)

## Side effects

* `gltf.functions.selectVariantByName/Index()` save an original (core-spec) material as `mesh.userData.originalMaterial` for each Mesh
* `gltf.functions.selectVariantByName/Index()` save a selected variant material as `mesh.userData.variantMaterials[variantIndex]` for each Mesh. It is expected to be used when exporting with [GLTFExporter KHR_materials_variants plugin](../../exporters/KHR_materials_variants/#README.md).
* Meshes generated by the loader and using `KHR_materials_variants` extension will have [mapping]( https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_variants#mappings) under `mesh.userData.gltfExtensions.KHR_materials_variants`

## Limitations

* `selectVariantByName/Index()` don't have selective option. All the meshes under a scene switch their materials.
* `selectVariantByName/Index()` don't have effect to meshes which are already removed from a scene
* This plugin may not work if a glTF node has camera, light, or other extension objects in addition to mesh. This limitation may be removed if [this suggestion](https://github.com/mrdoob/three.js/pull/19359#issuecomment-774487100) is accepted.
