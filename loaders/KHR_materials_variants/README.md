# [KHR_materials_variants](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_variants) extension

## How to use

```javascript
import * as THREE from 'path_to_three.module.js';
import { GLTFLoader } from 'path_to_GLTFLoader.js';
import GLTFMaterialsVariantsExtension from 'path_to_three-gltf-plugins/loaders/KHR_materials_variants/plugin.js';

const loader = new GLTFLoader();
loader.register(parser => new GLTFMaterialsVariantsExtension(parser));
loader.load(path_to_gltf_asset, async gltf => {
  const variants = gltf.userData.variants; // [variantName0, variantName1, ...]
  const variantName = variants[theIndexYouWantToUse];
  await gltf.functions.selectVariant(gltf.scene, variantName);
  render();
});
```

## Compatible Three.js revision

&gt;= r126dev with [#21207](https://github.com/mrdoob/three.js/pull/21207)

## API

If glTF file includes `KHR_materials_variants` extension, the result returned by the loader will have the following data and function.

**gltf.userData.variants**

**gltf.scene.userData.variants**

**gltf.scenes[n].userData.variants**

`variants` is an array of variant names like `[variantName0, variantName1, ...]`.

**mesh.userData.gltfExtensions.KHR_materials_variants**

`KHR_materials_variants` is an object which stores `KHR_materials_variants` 

**gltf.functions.selectVariant(scene: THREE.Scene, variantName: string): Promise**

`selectVariant()` is a function to switch a material to the one associated with `variantName` for all meshes under a `scene`. `variantName` should be one of `variants` mentioned above. The returned Promise will be resolved when the all selected materials are ready.

## Side effect

* `gltf.functions.selectVariant()` saves an original (core-spec) material as `mesh.userData.originalMaterial` for each Mesh if non-original material is selected
* Generated Meshes generated by the loader and using `KHR_materials_variants` extension will have [mapping]( https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_variants#mappings) under `mesh.userData.gltfExtensions.KHR_materials_variants`

## Limitations

* `selectVariant()` doesn't have selective option. All the meshes under a scene switches their materials.
* `selectVariant()` doesn't have effect to meshes which are already removed from a scene
* This plugin may not work if a glTF node has camera, light, or other extension objects in addition to mesh. This limitation may be removed if [this suggestion](https://github.com/mrdoob/three.js/pull/19359#issuecomment-774487100) is accepted.
